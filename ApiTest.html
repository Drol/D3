<html>
<head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
<script src="http://eu.battle.net/d3/static/js/tooltips.js"></script>

<script type="text/javascript">
	function getProfile(profile, callback)
	{
		// http://eu.battle.net/d3/en/profile/Drol-1245/hero/6723865
		// GET /api/d3/profile/Straton-1/hero/1
		var url = 'http://eu.battle.net/api/d3/profile/' + profile + '/?callback=?';
		$.getJSON(url, function(data) {
			callback(data);
		});
	}
	
	function getHero(profile, hero, callback)
	{
		// http://eu.battle.net/d3/en/profile/Drol-1245/hero/6723865
		// GET /api/d3/profile/Straton-1/hero/1
		var url = 'http://eu.battle.net/api/d3/profile/' + profile + '/hero/' + hero + '?callback=?';
		$.getJSON(url, function(data) {
			callback(data);
		});
	}

	$(document).ready(function() {
		// Tooltiphack
		var b = Bnet.D3.Tooltips;
		b.registerDataOld = b.registerData;
		b.registerData = function(data) {
		var c = document.body.children, s = c[c.length-1].src;
			data.params.key=s.substr(0,s.indexOf('?')).substr(s.lastIndexOf('/')+1);
			this.registerDataOld(data);
		}
		
		getProfile('Drol-1245', function(data) {	  
			$.each(data.heroes, function(key, hero) {
				var a = $("<a/>").attr({href: hero.id}).text(hero.name);
				var c1 = $("<td/>").append(a);
				var row = $("<tr/>").append(c1);

				$('#itemTable').append(row);
			});
			
			$.each(data.heroes, function(key, hero) {
				getHero('Drol-1245', hero.id, function(data) {	  
					$.each(data.items, function(key, item) {
						var itemUrl = 'http://eu.battle.net/d3/en/' + item.tooltipParams;
						var iconUrl = 'http://media.blizzard.com/d3/icons/items/large/' + item.icon + ".png";
						var a = $("<a/>").attr({href: itemUrl}).text(item.name);
						var img = $("(<img/>").attr({src: iconUrl});
						a.append(img);
						var c1 = $("<td/>").append(a);
						var row = $("<tr/>").append(c1);

						$('#itemTable').append(row);
					});
				});
			});
		});
	});
</script>
</head>

<body>
	<table id="itemTable"></table>
</body>
</html>